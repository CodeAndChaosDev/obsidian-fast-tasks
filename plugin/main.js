/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var T=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var D=(p,a)=>{for(var t in a)T(p,t,{get:a[t],enumerable:!0})},L=(p,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let i of M(a))!A.call(p,i)&&i!==t&&T(p,i,{get:()=>a[i],enumerable:!(e=b(a,i))||e.enumerable});return p};var N=p=>L(T({},"__esModule",{value:!0}),p);var E={};D(E,{default:()=>w});module.exports=N(E);var x=require("obsidian");var m=require("obsidian"),k=class extends m.Modal{constructor(t,e){super(t);this.description="";this.priority="\u26A0 Medium";this.time="";this.duration="";this.tags=[];this.onSubmit=e}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:"New Task"}),new m.Setting(t).setName("Description").addText(e=>e.onChange(i=>{this.description=i})),new m.Setting(t).setName("Priority").addDropdown(e=>e.addOption("\u{1F525} High","\u{1F525} High").addOption("\u26A0 Medium","\u26A0 Medium").addOption("\u{1F4A4} Low","\u{1F4A4} Low").setValue(this.priority).onChange(i=>{this.priority=i})),new m.Setting(t).setName("Time (HH:MM)").addText(e=>e.setPlaceholder("14:30").onChange(i=>{this.time=i})),new m.Setting(t).setName("Estimated Duration").addText(e=>e.setPlaceholder("30min").onChange(i=>{this.duration=i})),new m.Setting(t).setName("Tags (comma-separated)").addText(e=>e.setPlaceholder("#work, #deep").onChange(i=>{this.tags=i.split(",").map(o=>o.trim()).filter(o=>o.length>0)})),new m.Setting(t).addButton(e=>e.setButtonText("Add Task").setCta().onClick(()=>{this.onSubmit({description:this.description,priority:this.priority,time:this.time,duration:this.duration,tags:this.tags}),this.close()}))}onClose(){this.contentEl.empty()}};var c=require("obsidian"),g=class{constructor(a){this.app=a}async insertTask(a){var o,r,s,n;let t=this.app.workspace.getActiveFile();if(!t)return;let e=await this.app.vault.read(t),i=`- [ ] ${a.priority} ${a.description} @${(o=a.time)!=null?o:""} (${(r=a.duration)!=null?r:""}) ${(n=(s=a.tags)==null?void 0:s.join(" "))!=null?n:""}
`;await this.app.vault.modify(t,e+`
`+i)}async getTasksFromActiveFile(){let a=this.app.workspace.getActiveFile();if(!a)return null;let e=(await this.app.vault.read(a)).split(`
`),i=[];return e.forEach((o,r)=>{if(o.trim().startsWith("- [ ]")){let s=o.match(/- \[ \] (ðŸ”¥ High|âš  Medium|ðŸ’¤ Low)?\s?(.*?)\s?@(\d{1,2}:\d{2})?\s?\((.*?)\)?\s?(.*)?/);if(s){let[,n,l,d,h,u]=s;i.push({priority:n!=null?n:"\u26A0 Medium",description:l.trim(),time:d!=null?d:"",duration:h!=null?h:"",tags:u?u.split(" ").filter(Boolean):[],lineNumber:r})}}}),{tasks:i,lines:e,file:a}}async moveTask(a){var u;let t=await this.getTasksFromActiveFile();if(!t)return;let{tasks:e,lines:i,file:o}=t,r=(u=this.app.workspace.getActiveViewOfType(c.MarkdownView))==null?void 0:u.editor;if(!r)return;let s=r.getCursor().line,n=e.find(C=>C.lineNumber===s);if(!n||n.lineNumber===void 0)return;let l=n.lineNumber,d=l+a;if(d<0||d>=i.length)return;let h=i[l];i[l]=i[d],i[d]=h,await this.app.vault.modify(o,i.join(`
`)),r.setCursor({line:d,ch:0})}async rescheduleTask(){var r;if(!this.app.workspace.getActiveFile())return;let t=(r=this.app.workspace.activeEditor)==null?void 0:r.editor;if(!t)return;let e=t.getCursor().line,i=t.getLine(e);if(!i.match(/- \[ \]/)){new c.Notice("Not a task line");return}new y(this.app,async s=>{let n=i.replace(/@[\d:]+/,`@${s}`);t.setLine(e,n),new c.Notice(`Rescheduled to ${s}`)}).open()}async togglePriority(){var d;let a=await this.getTasksFromActiveFile();if(!a)return;let{tasks:t,lines:e,file:i}=a,o=(d=this.app.workspace.getActiveViewOfType(c.MarkdownView))==null?void 0:d.editor;if(!o)return;let r=o.getCursor().line,s=t.find(h=>h.lineNumber===r);if(!s)return;let n=s.priority==="\u{1F525} High"?"\u26A0 Medium":s.priority==="\u26A0 Medium"?"\u{1F4A4} Low":"\u{1F525} High",l=e[r];e[r]=l.replace(/(ðŸ”¥ High|âš  Medium|ðŸ’¤ Low)/,n),await this.app.vault.modify(i,e.join(`
`))}},y=class extends c.Modal{constructor(t,e){super(t);this.onSubmit=e}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:"New Time (HH:MM)"});let e=new c.TextComponent(t);e.inputEl.style.width="100%",e.setPlaceholder("14:30"),new c.ButtonComponent(t).setButtonText("Save").setCta().onClick(()=>{let i=e.getValue().trim();if(!i.match(/^\d{1,2}:\d{2}$/)){new c.Notice("Invalid time format");return}this.onSubmit(i),this.close()})}onClose(){let{contentEl:t}=this;t.empty()}};var v=require("obsidian"),f=class extends v.ItemView{constructor(t,e){super(t);this.manager=e}getViewType(){return"taskmaster-sidebar"}getDisplayText(){return"TaskMaster Sidebar"}async onOpen(){var i,o,r;let t=this.containerEl.children[1];t.empty(),t.createEl("h3",{text:"Your Tasks"});let e=await this.manager.getTasksFromActiveFile();if(!e){t.createEl("p",{text:"No active file or tasks found."});return}for(let s of e.tasks)t.createEl("div",{text:`${s.priority} ${s.description} @${(i=s.time)!=null?i:""} (${(o=s.duration)!=null?o:""}) ${(r=s.tags)==null?void 0:r.join(" ")}`}).classList.add("task-sidebar-item")}async onClose(){}};var w=class extends x.Plugin{async onload(){this.manager=new g(this.app),this.registerView("taskmaster-sidebar",t=>new f(t,this.manager)),this.addRibbonIcon("check-circle","Open Task Sidebar",()=>{this.activateView()}),this.addCommand({id:"open-task-modal",name:"Create New Task",hotkeys:[{modifiers:["Mod"],key:"q"}],callback:()=>new k(this.app,t=>this.manager.insertTask(t)).open()}),this.addCommand({id:"move-task-up",name:"Move Task Up",hotkeys:[{modifiers:["Mod"],key:"ArrowUp"}],callback:()=>this.manager.moveTask(-1)}),this.addCommand({id:"move-task-down",name:"Move Task Down",hotkeys:[{modifiers:["Mod"],key:"ArrowDown"}],callback:()=>this.manager.moveTask(1)}),this.addCommand({id:"reschedule-task",name:"Reschedule Task",hotkeys:[{modifiers:["Mod"],key:"r"}],callback:()=>this.manager.rescheduleTask()}),this.addCommand({id:"toggle-priority",name:"Toggle Task Priority",hotkeys:[{modifiers:["Mod"],key:"p"}],callback:()=>this.manager.togglePriority()})}async activateView(){let t=this.app.workspace.getRightLeaf(!1);t&&(await t.setViewState({type:"taskmaster-sidebar",active:!0}),this.app.workspace.revealLeaf(t))}onunload(){this.app.workspace.detachLeavesOfType("taskmaster-sidebar")}};
