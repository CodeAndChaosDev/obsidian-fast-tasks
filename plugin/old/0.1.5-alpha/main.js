/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var y=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var A=Object.prototype.hasOwnProperty;var S=(d,a)=>{for(var t in a)y(d,t,{get:a[t],enumerable:!0})},D=(d,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let i of M(a))!A.call(d,i)&&i!==t&&y(d,i,{get:()=>a[i],enumerable:!(e=C(a,i))||e.enumerable});return d};var E=d=>D(y({},"__esModule",{value:!0}),d);var L={};S(L,{default:()=>w});module.exports=E(L);var b=require("obsidian");var m=require("obsidian"),k=class extends m.Modal{constructor(t,e){super(t);this.description="";this.priority="\u26A0 Medium";this.time="";this.duration="";this.tags=[];this.onSubmit=e}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:"New Task"}),new m.Setting(t).setName("Description").addText(e=>e.onChange(i=>{this.description=i})),new m.Setting(t).setName("Priority").addDropdown(e=>e.addOption("\u{1F525} High","\u{1F525} High").addOption("\u26A0 Medium","\u26A0 Medium").addOption("\u{1F4A4} Low","\u{1F4A4} Low").setValue(this.priority).onChange(i=>{this.priority=i})),new m.Setting(t).setName("Time (HH:MM)").addText(e=>e.setPlaceholder("14:30").onChange(i=>{this.time=i})),new m.Setting(t).setName("Estimated Duration").addText(e=>e.setPlaceholder("30min").onChange(i=>{this.duration=i})),new m.Setting(t).setName("Tags (comma-separated)").addText(e=>e.setPlaceholder("#work, #deep").onChange(i=>{this.tags=i.split(",").map(s=>s.trim()).filter(s=>s.length>0)})),new m.Setting(t).addButton(e=>e.setButtonText("Add Task").setCta().onClick(()=>{this.onSubmit({description:this.description,priority:this.priority,time:this.time,duration:this.duration,tags:this.tags}),this.close()}))}onClose(){this.contentEl.empty()}};var c=require("obsidian"),f=class{constructor(a,t){this.app=a;this.sidebar=t}setSidebar(a){this.sidebar=a}refreshSidebar(){var a,t;(t=(a=this.sidebar)==null?void 0:a.refreshView)==null||t.call(a)}async insertTask(a){var s,r,o,n;let t=this.app.workspace.getActiveFile();if(!t)return;let e=await this.app.vault.read(t),i=`- [ ] ${a.priority} ${a.description} @${(s=a.time)!=null?s:""} (${(r=a.duration)!=null?r:""}) ${(n=(o=a.tags)==null?void 0:o.join(" "))!=null?n:""}
`;await this.app.vault.modify(t,e+`
`+i),this.refreshSidebar()}async getTasksFromActiveFile(){let a=this.app.workspace.getActiveFile();if(!a)return null;let e=(await this.app.vault.read(a)).split(`
`),i=[];return e.forEach((s,r)=>{if(s.trim().startsWith("- [ ]")){let o=s.match(/- \[ \] (ðŸ”¥ High|âš  Medium|ðŸ’¤ Low)?\s?(.*?)\s?@(\d{1,2}:\d{2})?\s?\((.*?)\)?\s?(.*)?/);if(o){let[,n,l,p,h,u]=o;i.push({priority:n!=null?n:"\u26A0 Medium",description:l.trim(),time:p!=null?p:"",duration:h!=null?h:"",tags:u?u.split(" ").filter(Boolean):[],lineNumber:r})}}}),{tasks:i,lines:e,file:a}}async moveTask(a){var u;let t=await this.getTasksFromActiveFile();if(!t)return;let{tasks:e,lines:i,file:s}=t,r=(u=this.app.workspace.getActiveViewOfType(c.MarkdownView))==null?void 0:u.editor;if(!r)return;let o=r.getCursor().line,n=e.find(x=>x.lineNumber===o);if(!n||n.lineNumber===void 0)return;let l=n.lineNumber,p=l+a;if(p<0||p>=i.length)return;let h=i[l];i[l]=i[p],i[p]=h,await this.app.vault.modify(s,i.join(`
`)),r.setCursor({line:p,ch:0}),this.refreshSidebar()}async rescheduleTask(){var r;if(!this.app.workspace.getActiveFile())return;let t=(r=this.app.workspace.activeEditor)==null?void 0:r.editor;if(!t)return;let e=t.getCursor().line,i=t.getLine(e);if(!i.match(/- \[ \]/)){new c.Notice("Not a task line");return}let s=new v(this.app,async o=>{let n=i.replace(/@[\d:]+/,`@${o}`);t.setLine(e,n),new c.Notice(`Rescheduled to ${o}`)});this.refreshSidebar(),s.open()}async togglePriority(){var p;let a=await this.getTasksFromActiveFile();if(!a)return;let{tasks:t,lines:e,file:i}=a,s=(p=this.app.workspace.getActiveViewOfType(c.MarkdownView))==null?void 0:p.editor;if(!s)return;let r=s.getCursor().line,o=t.find(h=>h.lineNumber===r);if(!o)return;let n=o.priority==="\u{1F525} High"?"\u26A0 Medium":o.priority==="\u26A0 Medium"?"\u{1F4A4} Low":"\u{1F525} High",l=e[r];e[r]=l.replace(/(ðŸ”¥ High|âš  Medium|ðŸ’¤ Low)/,n),await this.app.vault.modify(i,e.join(`
`)),this.refreshSidebar()}},v=class extends c.Modal{constructor(t,e){super(t);this.onSubmit=e}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:"New Time (HH:MM)"});let e=new c.TextComponent(t);e.inputEl.style.width="100%",e.setPlaceholder("14:30"),new c.ButtonComponent(t).setButtonText("Save").setCta().onClick(()=>{let i=e.getValue().trim();if(!i.match(/^\d{1,2}:\d{2}$/)){new c.Notice("Invalid time format");return}this.onSubmit(i),this.close()})}onClose(){let{contentEl:t}=this;t.empty()}};var T=require("obsidian"),g=class extends T.ItemView{constructor(t,e){super(t);this.manager=e}getViewType(){return"taskmaster-sidebar"}getDisplayText(){return"TaskMaster Sidebar"}async onOpen(){var i,s,r;let t=this.containerEl.children[1];t.empty(),t.createEl("h3",{text:"Your Tasks"});let e=await this.manager.getTasksFromActiveFile();if(!e){t.createEl("p",{text:"No active file or tasks found."});return}for(let o of e.tasks)t.createEl("div",{text:`${o.priority} ${o.description} @${(i=o.time)!=null?i:""} (${(s=o.duration)!=null?s:""}) ${(r=o.tags)==null?void 0:r.join(" ")}`}).classList.add("task-sidebar-item")}async onClose(){}async refreshView(){var i;let t=this.containerEl.children[1];t.empty(),t.createEl("h3",{text:"Your Tasks (Auto-updated)"});let e=await this.manager.getTasksFromActiveFile();if(e)for(let s of e.tasks)t.createEl("div",{text:`${s.priority} ${s.description} @${(i=s.time)!=null?i:""}`})}};var w=class extends b.Plugin{constructor(){super(...arguments);this.sidebar=null}async onload(){var e,i;this.manager=new f(this.app),(i=(e=this.app.viewRegistry)==null?void 0:e.views)!=null&&i["taskmaster-sidebar"]||this.registerView("taskmaster-sidebar",s=>{let r=new g(s,this.manager);return this.sidebar=r,this.manager.setSidebar(r),r}),this.addRibbonIcon("check-circle","Open Task Sidebar",()=>{this.activateView()}),this.addCommand({id:"open-task-modal",name:"Create New Task",hotkeys:[{modifiers:["Mod"],key:"q"}],callback:()=>new k(this.app,s=>this.manager.insertTask(s)).open()}),this.addCommand({id:"move-task-up",name:"Move Task Up",hotkeys:[{modifiers:["Mod"],key:"ArrowUp"}],callback:()=>this.manager.moveTask(-1)}),this.addCommand({id:"move-task-down",name:"Move Task Down",hotkeys:[{modifiers:["Mod"],key:"ArrowDown"}],callback:()=>this.manager.moveTask(1)}),this.addCommand({id:"reschedule-task",name:"Reschedule Task",hotkeys:[{modifiers:["Mod"],key:"r"}],callback:()=>this.manager.rescheduleTask()}),this.addCommand({id:"toggle-priority",name:"Toggle Task Priority",hotkeys:[{modifiers:["Mod"],key:"p"}],callback:()=>this.manager.togglePriority()})}async activateView(){let t=this.app.workspace.getRightLeaf(!1);t&&(await t.setViewState({type:"taskmaster-sidebar",active:!0}),this.app.workspace.revealLeaf(t))}onunload(){var e,i;this.app.workspace.detachLeavesOfType("taskmaster-sidebar");let t=this.app;(i=(e=t.viewRegistry)==null?void 0:e.views)!=null&&i["taskmaster-sidebar"]&&delete t.viewRegistry.views["taskmaster-sidebar"]}};
