/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var w=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var C=Object.prototype.hasOwnProperty;var D=(r,a)=>{for(var t in a)w(r,t,{get:a[t],enumerable:!0})},A=(r,a,t,e)=>{if(a&&typeof a=="object"||typeof a=="function")for(let i of M(a))!C.call(r,i)&&i!==t&&w(r,i,{get:()=>a[i],enumerable:!(e=b(a,i))||e.enumerable});return r};var L=r=>A(w({},"__esModule",{value:!0}),r);var N={};D(N,{default:()=>u});module.exports=L(N);var x=require("obsidian");var d=require("obsidian"),l=class extends d.Modal{constructor(t,e){super(t);this.description="";this.priority="\u26A0 Medium";this.time="";this.duration="";this.tags=[];this.onSubmit=e}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:"New Task"}),new d.Setting(t).setName("Description").addText(e=>e.onChange(i=>{this.description=i})),new d.Setting(t).setName("Priority").addDropdown(e=>e.addOption("\u{1F525} High","\u{1F525} High").addOption("\u26A0 Medium","\u26A0 Medium").addOption("\u{1F4A4} Low","\u{1F4A4} Low").setValue(this.priority).onChange(i=>{this.priority=i})),new d.Setting(t).setName("Time (HH:MM)").addText(e=>e.setPlaceholder("14:30").onChange(i=>{this.time=i})),new d.Setting(t).setName("Estimated Duration").addText(e=>e.setPlaceholder("30min").onChange(i=>{this.duration=i})),new d.Setting(t).setName("Tags (comma-separated)").addText(e=>e.setPlaceholder("#work, #deep").onChange(i=>{this.tags=i.split(",").map(o=>o.trim()).filter(o=>o.length>0)})),new d.Setting(t).addButton(e=>e.setButtonText("Add Task").setCta().onClick(()=>{this.onSubmit({description:this.description,priority:this.priority,time:this.time,duration:this.duration,tags:this.tags}),this.close()}))}onClose(){this.contentEl.empty()}};var p=require("obsidian"),h=class{constructor(a){this.app=a}async insertTask(a){var o,n,s,c;let t=this.app.workspace.getActiveFile();if(!t)return;let e=await this.app.vault.read(t),i=`- [ ] ${a.priority} ${a.description} @${(o=a.time)!=null?o:""} (${(n=a.duration)!=null?n:""}) ${(c=(s=a.tags)==null?void 0:s.join(" "))!=null?c:""}
`;await this.app.vault.modify(t,e+`
`+i)}async getTasksFromActiveFile(){let a=this.app.workspace.getActiveFile();if(!a)return null;let e=(await this.app.vault.read(a)).split(`
`),i=[];return e.forEach((o,n)=>{if(o.trim().startsWith("- [ ]")){let s=o.match(/- \[ \] (ðŸ”¥ High|âš  Medium|ðŸ’¤ Low)?\s?(.*?)\s?@(\d{1,2}:\d{2})?\s?\((.*?)\)?\s?(.*)?/);if(s){let[,c,m,g,f,y]=s;i.push({priority:c!=null?c:"\u26A0 Medium",description:m.trim(),time:g!=null?g:"",duration:f!=null?f:"",tags:y?y.split(" ").filter(Boolean):[],lineNumber:n})}}}),{tasks:i,lines:e,file:a}}async moveTask(a){var m;let t=await this.getTasksFromActiveFile();if(!t)return;let{tasks:e,lines:i,file:o}=t,n=(m=e[0])==null?void 0:m.lineNumber;if(n===void 0)return;let s=n+a;if(s<0||s>=i.length)return;let c=i[n];i[n]=i[s],i[s]=c,await this.app.vault.modify(o,i.join(`
`))}async rescheduleTask(){var n;if(!this.app.workspace.getActiveFile())return;let t=(n=this.app.workspace.activeEditor)==null?void 0:n.editor;if(!t)return;let e=t.getCursor().line,i=t.getLine(e);if(!i.match(/- \[ \]/)){new p.Notice("Not a task line");return}new T(this.app,async s=>{let c=i.replace(/@[\d:]+/,`@${s}`);t.setLine(e,c),new p.Notice(`Rescheduled to ${s}`)}).open()}async togglePriority(){let a=await this.getTasksFromActiveFile();if(!a)return;let{tasks:t,lines:e,file:i}=a,o=t[0],n=o.priority==="\u{1F525} High"?"\u26A0 Medium":o.priority==="\u26A0 Medium"?"\u{1F4A4} Low":"\u{1F525} High",s=e[o.lineNumber];e[o.lineNumber]=s.replace(/(ðŸ”¥ High|âš  Medium|ðŸ’¤ Low)/,n),await this.app.vault.modify(i,e.join(`
`))}},T=class extends p.Modal{constructor(t,e){super(t);this.onSubmit=e}onOpen(){let{contentEl:t}=this;t.createEl("h2",{text:"New Time (HH:MM)"});let e=new p.TextComponent(t);e.inputEl.style.width="100%",e.setPlaceholder("14:30"),new p.ButtonComponent(t).setButtonText("Save").setCta().onClick(()=>{let i=e.getValue().trim();if(!i.match(/^\d{1,2}:\d{2}$/)){new p.Notice("Invalid time format");return}this.onSubmit(i),this.close()})}onClose(){let{contentEl:t}=this;t.empty()}};var v=require("obsidian"),k=class extends v.ItemView{constructor(t,e){super(t);this.manager=e}getViewType(){return"taskmaster-sidebar"}getDisplayText(){return"TaskMaster Sidebar"}async onOpen(){var i,o,n;let t=this.containerEl.children[1];t.empty(),t.createEl("h3",{text:"Your Tasks"});let e=await this.manager.getTasksFromActiveFile();if(!e){t.createEl("p",{text:"No active file or tasks found."});return}for(let s of e.tasks)t.createEl("div",{text:`${s.priority} ${s.description} @${(i=s.time)!=null?i:""} (${(o=s.duration)!=null?o:""}) ${(n=s.tags)==null?void 0:n.join(" ")}`}).classList.add("task-sidebar-item")}async onClose(){}};var u=class extends x.Plugin{async onload(){this.manager=new h(this.app),this.registerView("taskmaster-sidebar",t=>new k(t,this.manager)),this.addRibbonIcon("check-circle","Open Task Sidebar",()=>{this.activateView()}),this.addCommand({id:"open-task-modal",name:"Create New Task",hotkeys:[{modifiers:["Mod"],key:"q"}],callback:()=>new l(this.app,t=>this.manager.insertTask(t)).open()}),this.addCommand({id:"move-task-up",name:"Move Task Up",hotkeys:[{modifiers:["Mod"],key:"ArrowUp"}],callback:()=>this.manager.moveTask(-1)}),this.addCommand({id:"move-task-down",name:"Move Task Down",hotkeys:[{modifiers:["Mod"],key:"ArrowDown"}],callback:()=>this.manager.moveTask(1)}),this.addCommand({id:"reschedule-task",name:"Reschedule Task",hotkeys:[{modifiers:["Mod"],key:"r"}],callback:()=>this.manager.rescheduleTask()}),this.addCommand({id:"toggle-priority",name:"Toggle Task Priority",hotkeys:[{modifiers:["Mod"],key:"p"}],callback:()=>this.manager.togglePriority()})}async activateView(){let t=this.app.workspace.getRightLeaf(!1);t&&(await t.setViewState({type:"taskmaster-sidebar",active:!0}),this.app.workspace.revealLeaf(t))}onunload(){this.app.workspace.detachLeavesOfType("taskmaster-sidebar")}};
